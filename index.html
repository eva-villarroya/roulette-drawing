<html>
	<header>
		<script src="raphael.js"></script>
		 <style type="text/css">  
            #canvas_container {  
                width: 500px;
                height: 500px;  
                border: 1px solid #aaa;  
            }  
        </style>
	<header>
	<body>
		<div id="canvas_container"></div>
		
		<script type="text/javascript">
		
			var canvasSize = 500;
			var centerCanvas = canvasSize / 2;
			var canvasColor = '#FFF';

			// amplification of view
			var zoom = 150;

			// radius of static circle
			var R = 1 * zoom;
			// radius of moving circle 
			var r = 10/13 * zoom;
			// distance from radius of moving circle of drawing point
			var d = 11/13 * zoom;
			
			// spin size of moving circle
			var rotation = 2.5;
			
			var circlesDistance = R - r;
			
			var angleTransformation =  Math.PI / 200;
			
			var red = 0;
			var green = 0;
			var blue = 0;
			var strokeWidth = 1;
			
			
			var paper = Raphael("canvas_container", canvasSize,canvasSize);
			paper.canvas.style.backgroundColor = canvasColor;
			
			function draw(){
			
				firstPoint = calculatePoint(0);
				
				angle = rotation;
			
				var keepOnDrawing = true;
				var lastPoint = firstPoint;
				
				do {
					currentPoint = calculatePoint(angle);
					
					//colorRainbow(angle);						
					//greyscaleDegradation(angle);
					//red = 255; // move to line 56
					//colorDegradation(angle, "red");
						
					red = funColors(angle);
					blue = 154;
					green = 75; 
					
					var color = "rgb(" + red + ", " + green + ", " + blue + ")";
					
					drawLine(lastPoint[0], lastPoint[1], currentPoint[0], currentPoint[1], color);
										
					keepOnDrawing = (currentPoint[0] != firstPoint[0]) || (currentPoint[1] != firstPoint[1]);
					
					if(keepOnDrawing) {						

						angle = angle + rotation;
						
						lastPoint = currentPoint;

					}
					
				} while(keepOnDrawing);	
			}
		
			function calculatePoint(angle){
				
			    var calculatedAngle = angle * angleTransformation;
				var tmpCalc = (circlesDistance/r) * calculatedAngle;
			
				var pointX = circlesDistance * Math.cos(calculatedAngle) + d * Math.cos(tmpCalc);
				var pointY = circlesDistance * Math.sin(calculatedAngle) - d * Math.sin(tmpCalc);
				
				return [parseFloat(pointX.toFixed(2)), parseFloat(pointY.toFixed(2))];
				
			}
			
			function drawLine(x, y, nextX, nextY, color){
			    var line = paper.path( ["M", x + centerCanvas, y + centerCanvas, "L", 
			    	nextX + centerCanvas, nextY + centerCanvas]);
			    line.attr ("stroke", color);
			    line.attr("stroke-width", strokeWidth);
			}
			
			function colorRainbow(angle) {
				blue = (angle * 2) % 255;
				
				green = (angle * 2) % 510;
				
				if(green > 254) {
					green = 510 - green;
				}
				
				red = (angle * 4) % 255;
			
			}
			
			function greyscaleDegradation(angle){
						blue = angle % 510;
						
						if(blue > 254) {
							blue = 510 - blue;
						}
					
						green = angle % 510;
						
						if(green > 254) {
							green = 510 - green;
						}
						
						red = angle % 510;
						
						if(red > 254) {
							red = 510 - red;
						}
			}
			
			function funColors(angle) {
				var module = 420;
			
				var color = angle % module;
				
				if(color > (module / 2)) {
					color = (module - color);
				}
				
				return color;
			}
			
			function colorDegradation(angle, skipColor){
				var color = funColors(angle);
				
				if(skipColor != "blue") {
						blue = color;
				}
				
				if(skipColor != "green") {	
						green = color;
						
				}
				
				if(skipColor != "red") {		
						red = color;
				}
			}
		
			draw();
		</script>
	</body>
</html>